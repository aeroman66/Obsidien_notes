# 二维情况
（此处应有一图）
我们想要将二维平面上一个向量投影到另一个向量上。我们都知道垂直投影造成的误差最小，即：
$$
a^{T} (b - xa) = 0
$$
通过运算，我们可以求解出 x：
$$
x = \frac{a^{T}b}{a^{T}a}
$$
同时，因为投影结果与 a 平行，我们有：
$$
p = ax
$$
我们还可以定义投影矩阵 P：
$$
p = ax = a\frac{a^{T}b}{a^{T}a} = Pb
$$
$$
P = \frac{aa^{T}}{a^{T}a}
$$
对于投影来说，随着 b 线性变化，不随 a 的变化而变化。
对 P 进行分析，我们发现 P 的 4 条性质：
1. $C(P)$ = line through a
2. $rank(P) = 1$
3. $P^{T} = P$
4. $P^{2} = P$

# WHY
我们为什么要做投影？
最终目标还是要求解方程组
我们来思考一个问题：我们想要测量天上一颗卫星的位置，测量一千次得到了一千组方程，但是确定位置并用不上这么多未知数，也就是说方程数超过了未知数的数量，这样可能导致方程组没有解。一堆好数据中难免混入一些“坏数据”，搅乱计算。但是，在这样的情况下，我们还是想求解出一个最优的卫星位置的解，与现实位置最接近的解。
- 暴力法
一个个剔除多余的方程，直到最后剩下一个有解的方程组。
这样得到的结果必然非常的不准确。
- 利用投影
正因为方程组不一定有解，b 不一定在 A 的列空间中：
$$
Ax = b
$$
因此我们想要把 b 投影到 A 的列空间中，求得**最优解**。将原方程变为求解：
$$
A\hat{x} = p
$$
# 拓展到高维空间 & 最小二乘
	最小二乘法很容易受到离群者的影响(outlier)
（此处应有一图）
为了方便，就研究将三维向量投影到二维子平面的方法。假设我们知道平面的一组基 $a_{1}, a_{2}$，那其实就相当于我们已经知道了方程组：
$$
Ax = 
\begin{bmatrix}
a_{1}  & a_{2} 
\end{bmatrix}
x = b
$$
b 不在 A 的列空间当中，因此我们做投影：
$$
p = \hat{x}_{1}a_{1} + \hat{x}_{2}a_{2}
$$
$$
A\hat{x} = p
$$
求解这个方程有一个关键点，也就是误差向量是垂直于平面子空间的，即：
$$
a_{1}^{T}(b - A\hat{x}) = 0, a_{2}^{T}(b - A\hat{x}) = 0
$$
将这个式子写成矩阵形式，状况就会一目了然：
$$
\begin{bmatrix}
a_{1}^{T} \\
a_{2}^{T}
\end{bmatrix}
(b - A\hat{x})
=
\begin{bmatrix}
0 \\
0
\end{bmatrix}
$$
$$
A^{T}
(b - A\hat{x})
=
\begin{bmatrix}
0 \\
0
\end{bmatrix}
$$
$$
b - A\hat{x} = e \in N(A^{T})
$$
就这样，我们得到了及其核心的 **Normal equation**:
$$
A^{T}A\hat{x} = A^{T}b
$$
回带后我们得到以下形式，他跟一维情况是互通的：
$$
P = A(A^{T}A)^{-1}A^{T}
$$
（此处应有一图）
我们还发现投影矩阵的一条性质，因为误差向量也可以看作是 b 在左零空间上的投影，所以：
$$
b = p + e = Pb + (I - P)b
$$
我们发现 $I - P$ 竟然也是一个投影矩阵：
$$
(I - P)^{T} = (I - P), (I - P)^{2} = (I - P)
$$
## 检验
- if b in column space
这就意味着 b 一定可以写成以下形式：
$$
b = Ax
$$
所以，得出 b 的投影还是他自己：
$$
Pb = A(A^{T}A)^{-1}A^{T}Ax = Ax = b
$$
- if b $\bot$ column space
这样我们知道：
$$
b \in N(A^{T})
$$
因此，b 投影后得到零向量，符合：
$$
Pb = A(A^{T}A)^{-1}A^{T}b = 0
$$
## 可逆性问题
上面得到的投影矩阵中，出现了 $(A^{T}A)^{-1}$ 部分，但我们如何保证这部分确实是可逆，让我们可以做投影呢？
**结论**：A 的各列如果线性无关，也就是说 A 是列满秩的，那么 $A^{T}A$ 可逆。
	换句话说，有效方程数目大于等于未知数数目，那么我们才能获得解，否则会有无数多解。
**证明**：
suppose:
$$
A^{T}Ax = 0
$$
IDEA:
$$
x^{T}A^{T}Ax = 0 = (Ax)^{T}Ax \Rightarrow Ax = 0
$$
因为 A 的各列线性独立，所以 A 的 nullspace 是零空间，所以：
$$
x = 0
$$
得出 $A^{T}A$ 的nullspace 为 0，它的各列也是线性独立的，又因为它是方阵，所以它可逆。
# Exemple
（此处应有一图）
为了拟合出关于这三点的最优直线，我们设直线为 $C + Dx = y$，假设直线经过每一个点，我们可以得到方程组：
$$
\begin{cases}
C + D = 1 \\
C + 2D = 2 \\
C + 3D = 2
\end{cases}
$$
	注意此处方程右边是 y 坐标构成的向量，所以拟合的直线是 y 方向上误差最小的直线。
	事实上，b 向量的选取是影响我们你和方式的。（其他拟合方式的方程还不知道怎么写）
我们得到线性方程组：
$$
\begin{bmatrix}
1 & 1 \\
1 & 2 \\
1 & 3
\end{bmatrix}
\begin{bmatrix}
C \\
D
\end{bmatrix}
=
\begin{bmatrix}
1 \\
2 \\
2
\end{bmatrix}
$$
根据前面得到的 normal equation，我们可以很快的得到方程组：
	用增广矩阵只是看上去简洁，不是必须的
$$
\begin{bmatrix}
1 & 1 & 1 \\
1 & 2 & 3
\end{bmatrix}
\begin{bmatrix}
1 & 1 & 1 \\
1 & 2 & 2 \\
1 & 3 & 2
\end{bmatrix}
=
\begin{bmatrix}
3 & 6 & 5\\
6 & 14 & 11
\end{bmatrix}
$$
因此，我们的方程组就是：
$$
\begin{cases}
3C + 6D = 5 \\
6C + 14D = 11
\end{cases}
$$
	此处其实还有一种偏微分方法可以得到一样的方程。