# 步态
1. 实现效果
代码原本采用的就是 TripodTrot 步态，即每时每刻都有三条腿与地面接触做支撑，腿分组如下
![[三脚架步态展示]]
演示中将步态改为如下分组，依旧能保持稳定
![[另类三脚架步态展示]]
2. 实现方法
在该代码中，将一个 mpc 控制周期记作 dt，而一个步态周期记作 mpc 周期的整数倍，即
$$
\text{segments} \times \text{dt}
$$
在一个完整的步态周期内，每条腿至少会完成一次完整的摆动轨迹。而至于某一时刻某条腿位于什么位置，我们用步态相位来描述。即假设将腿一开始与地面接触记作 0，摆动后重新与地面接触记作 1，我们用 0~1 之间的一个值作为这条腿的摆动相位，摆到一半时，摆动相位就为 0.5.
![[offsets.png]]
在代码中，摆动相位的计算是当前时刻所在步态周期的百分比值减去相位偏移量得到的，而该偏移量则在 mpcparams 中进行设置。
![[offsetfloat.png]]
想要对不同的腿进行分组，只需要保证同组的腿在每个控制周期，步态相位都相同即可，所以只要给他们设置相同的相位偏移量就好。
# 轨迹
1. 实现效果
本来想写一个简单的 起始点-中点-落脚点 用直线连接的轨迹，但是代码直接调用了 spline.h , 改起来不是很方便，最后只是将中点的位置进行调高展示效果。
2. 实现方法
在 SwingTrajectoryController 中，在确定了一条腿的起始点和落脚点后，用下式确定中间点
$$
\frac{\text{tipPosStart}(2)+\text{footHold(2)}}{2} + \text{viaPointHeight}
$$
然后用 spline 的三次样条插值获得轨迹，轨迹中的每个点对应一个时间戳（所以改用自己的轨迹感觉会很麻烦）。
这次的轨迹只是单纯的加大了 viaPointHeight 的值。