# 映射
在机器人学中，我们需要在不同参考坐标系中表达同一个量，于是我们讨论映射的**数学方法**。
映射这个概念描述的就是一个坐标系到另一个坐标系之间的变换。我们描述的量本身没有发生改变，只是我们描述他的方式发生了变化。
我们在这里先统一一下符号标准：
- 左上角字母代表是在那个参考系中的描述
- 下标则代表该量所在的参考系
- BORG B 参考系的 Origin
## 坐标平移
	姿态相同，原点不同
两个坐标系姿态相同时，我们只需要进行平移：
	要注意，我们这里研究的永远是 P 这个量本身，等号两边只是对相同对象的描述方式不同。
$$
^{A}P = ^{B}P + ^{A}P_{BORG}
$$
$^{A}P_{BORG}$ 定义了这个映射，因为这个向量中包含了进行变换所需的全部信息（平移的信息）

## 坐标旋转
	姿态不同，原点相同
两个坐标系原点重合，但是单位轴不重合，即姿态不同的时候。这里的推导和本质理解会比较困难。
- 旋转矩阵
将 B 的三根单位轴以 A 作为参考坐标系写出时，将这三个矢量排成一个 $3\times 3$ 的矩阵, 我们得到一个旋转矩阵：
$$
^{A}_{B}R = (^{A}\hat{X}_{B} \ ^{A}\hat{Y}_{B} \ ^{A}\hat{Z}_{B}) = 
\left(
\begin{matrix}
r_{11} & r_{12} & r_{13} \\
r_{21} & r_{22} & r_{23} \\
r_{31} & r_{32} & r_{33} \\
\end{matrix}
\right)
$$
	矩阵各列模长都为 1 ，且相互正交 Q
矩阵中每一项都表示矢量在参考坐标系中轴线上的投影
	下标第一位表示参考坐标系轴线编号，第二位则是物体坐标系矢量编号。
	B 在 A 中的描述。
$$
^{A}_{B}R = (^{A}\hat{X}_{B} \ ^{A}\hat{Y}_{B} \ ^{A}\hat{Z}_{B}) = 
\left(
\begin{matrix}
\hat{X}_{B}\cdot\hat{X}_{A} & \hat{Y}_{B}\cdot\hat{X}_{A} & \hat{Z}_{B}\cdot\hat{X}_{A} \\
\hat{X}_{B}\cdot\hat{Y}_{A} & \hat{Y}_{B}\cdot\hat{Y}_{A} & \hat{Z}_{B}\cdot\hat{Y}_{A} \\
\hat{X}_{B}\cdot\hat{Z}_{A} & \hat{Y}_{B}\cdot\hat{Z}_{A} & \hat{Z}_{B}\cdot\hat{Z}_{A} \\
\end{matrix}
\right)
$$
	这里点乘左右的两个矢量都是以 A 为参考描述的，所以我们省去了向量左上角的坐标系，因为只要描述向量的坐标系相同，那么坐标系的选择就不影响他们点乘的结果。因为我们最后得到的结果是标量，只与两个向量和向量夹脚的大小有关。
进一步观察旋转矩阵，我们发现，矩阵的行是 $\{ A \}$ 中的单位矢量在 $\{ B \}$ 中的表达，即：
$$
^{A}_{B}R = (^{A}\hat{X}_{B} \ ^{A}\hat{Y}_{B} \ ^{A}\hat{Z}_{B}) = 
\left(
\begin{matrix}
^{B}\hat{X}_{A}^{T} \\
^{B}\hat{Y}_{A}^{T} \\
^{B}\hat{Z}_{A}^{T}
\end{matrix}
\right)
$$
	这一点看上面的点乘式可以很快理解
因此两个坐标系之间的旋转矩阵，我们只需要通过将旋转矩阵做转置就可以得到。也因此，我们发现旋转矩阵是一个正交矩阵：
$$
^{A}_{B}R = ^{B}_{A}R^{-1} = ^{B}_{A}R^{T}
$$
	Q^{-1} = Q^{T}
	点的位置用矢量描述，姿态用固定在物体上的坐标系描述。
我们想要求解 $^{A}P$ ，我们注意到该矢量的每个分量就是其向坐标系上单位矢量方向的投影。由此我们可以得到以下计算：
$$
^{A}p_{x} = ^{B}\hat{X}_{A}\cdot ^{B}P
$$
$$
^{A}p_{y} = ^{B}\hat{Y}_{A}\cdot ^{B}P
$$
$$
^{A}p_{z} = ^{B}\hat{Z}_{A}\cdot ^{B}P
$$
以 $^{A}p_{x}$ 计算为例做讲解：
$$
\begin{align}
^{A}p_{x} &= ^{B}\hat{X}_{A}\cdot ^{B}P \\
&= \hat{X}_{B}\cdot\hat{X}_{A}\cdot ^{B}P + \hat{Y}_{B}\cdot\hat{X}_{A}\cdot ^{B}P + \hat{Z}_{B}\cdot\hat{X}_{A} \cdot ^{B}P \\
&= ^{B}p_{x}\cdot\hat{X}_{A} + ^{B}p_{y}\cdot\hat{X}_{A} + ^{B}p_{z}\cdot\hat{X}_{A} \\
&= ^{A}p_{x}
\end{align}
$$
以上计算方式可以总结为下式：
$$
^{A}P = ^{A}_{B}R\times^{B}P
$$
	没有错这里下标，因为本来要做转置。
	我们也可与从这里总结出一个比较迅速的下标相消原则。

## 一般变换
	姿态不同，原点不同
借助一个中间坐标系，**先将姿态变得相同，在进行坐标平移**。
$$
^{A}P = ^{A}_{B}R^{B}P + ^{A}P_{BORG}
$$
这样我们可以引入一个新的概念：
$$
^{A}P = ^{A}_{B}T^{B}P
$$
- 齐次变换矩阵
	作用更多是公式推导，而不拿来在计算机程序中做计算，因为会有计算时间浪费在 0，1 的相乘上，增加了矩阵维度。
这个表示的意义在于，用一个简单的矩阵同时表示了一般变换中的平移和旋转，而不用两个矩阵。
$$
\left( 
\begin{matrix}
^{A}P \\
1
\end{matrix}
\right)
= 
\left(
\begin{matrix}
^{A}_{B}R & ^{A}P_{BORG} \\
0 \ 0 \ 0 & 1
\end{matrix}
\right)
\left(
\begin{matrix}
^{B}P \\
1
\end{matrix}
\right)
$$
上面的式子可以写成下面两个式子：
$$
\begin{cases}
^{A}P &= ^{A}_{B}R^{B}P + ^{A}P_{BORG} \\
1 &= 1
\end{cases}
$$
这个齐次矩阵也可以用来**描述**一个坐标系，是统一了旋转和平移的描述方式。